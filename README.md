# RISE比較表作成ツール

東急リバブルの公式サイトから二子玉川ライズの中古マンション物件情報を自動取得し、比較表を作成するツールです。

## 機能

### 🔍 物件自動検出機能（v3）NEW!
- **幅優先探索（BFS）**で二子玉川ライズの全物件を自動発見
- 3つの棟（イースト/ウエスト/セントラル）から自動的にリンクを辿る
- 面積フィルタ（65㎡〜80㎡）で条件に合う物件のみを抽出
- 手動でURLを追加する必要なし！

### 📊 データ取得・分析
- 各物件から以下の情報を自動取得：
  - 管理番号
  - 販売価格（億円単位にも対応）
  - 平米単価・坪単価（自動計算）
  - 間取り
  - 専有面積
  - 棟名（イースト/ウエスト/セントラル）
  - 階数（現在階/総階数）
  - 築年月
  - 向き
  - リフォーム有無
  - お気に入り登録数
  - 担当者名

### 📝 出力機能
- Markdown形式の比較表を生成
- 平米単価の安い順に自動ソート
- タイムスタンプ付きファイル名で保存
- HTMLビューアーで美しく表示

### 📈 価格変遷追跡機能（v4）NEW!
- 全履歴をJSON形式で保存
- 価格変更、新規物件、販売終了を自動検出
- 日次変更レポートを自動生成
- 初出価格・最高値・最安値・累計変動額を記録
- いつ、いくら値下げがあったか完全に追跡可能

## セットアップ

### 必要な環境

- Python 3.7以上

### インストール

```bash
# 依存ライブラリのインストール
pip3 install -r requirements.txt
```

## 使い方

### 毎日自動更新（GitHub Actions）⭐ 推奨

**完全自動化**：Macを起動していなくても毎日自動更新されます。

#### 設定方法

1. GitHubリポジトリにpush（初回のみ）
2. GitHub Actionsが自動的に有効化
3. 毎日 **午前9時（日本時間）** に自動実行

#### 手動実行

GitHubリポジトリページで：
1. 「Actions」タブをクリック
2. 「Daily Data Update」を選択
3. 「Run workflow」をクリック

#### 実行ログの確認

「Actions」タブで実行履歴とログを確認できます。

---

### 基本的な実行（ローカル・手動）

```bash
python3 scraper.py
```

実行すると、以下の処理が行われます：

1. **物件自動検出**: シード物件から幅優先探索で全物件を発見
2. **面積フィルタ**: 65㎡〜80㎡の物件のみを抽出
3. **データ取得**: 各物件の詳細情報を取得
4. **変更検出**: 前回データとの差分を検出（価格変更、新規物件、販売終了）
5. **変更レポート生成**: `changes_YYYYMMDD.md` を作成（変更があった場合）
6. **価格履歴保存**: `price_tracker.json` と `history/` に保存
7. **比較表生成**: `comparison_table_YYYYMMDD_HHMMSS.md` を作成
8. **latest.md更新**: 最新データで更新

### 手動指定モード

`scraper.py`の冒頭で`AUTO_DISCOVER = False`に設定すると、手動指定モードになります。

```python
# scraper.py
AUTO_DISCOVER = False  # 手動指定モードに切替
```

手動モードでは`MANUAL_PROPERTY_URLS`リストの物件のみを取得します。

### ビジュアル表示（HTMLビューアー）

生成された比較表をブラウザーで美しく表示：

```bash
open viewer.html
```

または、Finderでダブルクリックして開く

**HTMLビューアーの特徴:**
- 🌙 ダークモード対応
- 📊 平米単価順のランキング表示
- 🎨 カラーバッジ（棟名・リフォーム有無）
- 📱 スマートフォン対応
- ✨ ホバーエフェクトやアニメーション
- 🔗 物件ページへの直リンク

### 出力例

```
============================================================
二子玉川ライズ 中古マンション比較表作成 v2
============================================================

[1/6] 取得中: https://www.livable.co.jp/mansion/C13252K32/
✓ C13252K32: 取得成功

[2/6] 取得中: https://www.livable.co.jp/mansion/C48258711/
✓ C48258711: 取得成功

...

✓ 比較表を作成しました: comparison_table_20251006_222711.md
```

### 生成される比較表の形式

| 管理番号 | 販売価格 | 平米単価 | 坪単価 | 間取り | 専有面積 | 棟名 | 階数 | 築年月 | 向き | リフォーム | 担当者 |
|---|---|---|---|---|---|---|---|---|---|---|---|
| C13252K32 | 15,800万円 | 224.69万円/㎡ | 741.5万円/坪 | 2LDK | 70.32㎡ | イースト | 17/42 | 2010年5月 | 南東 | 無 | 行方 |
| ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |

## ファイル構成

```
RISE/
├── README.md                      # このファイル
├── REQUIREMENTS.md                # 要件定義書（全機能の仕様）
├── requirements.txt               # Pythonパッケージ依存関係
├── scraper.py                     # メインスクリプト
├── price_tracker.py               # 価格追跡モジュール（v4）
├── index.html                     # HTMLビューアー（ブラウザー表示用）
├── latest.md                      # 最新の比較表（Markdown形式）
├── price_tracker.json             # 全物件の価格履歴（v4）
├── history/                       # 日次スナップショット（v4）
│   ├── 2025-10-07.json
│   └── 2025-10-08.json
└── changes_*.md                   # 日次変更レポート（v4）
```

## カスタマイズ

### 対象物件の変更

`scraper.py` の `PROPERTY_URLS` リストを編集することで、取得する物件を変更できます：

```python
PROPERTY_URLS = [
    "https://www.livable.co.jp/mansion/C13252K32/",
    "https://www.livable.co.jp/mansion/C48258711/",
    # 追加の物件URLをここに記載
]
```

### ソート順の変更

デフォルトでは平米単価の安い順にソートされますが、以下の行を変更することで別の基準でソートできます：

```python
# scraper.py の generate_comparison_table 関数内
sorted_properties = sorted(valid_properties, key=lambda x: x.get('price_per_sqm', float('inf')))
```

例：
- 販売価格順: `key=lambda x: x.get('price', float('inf'))`
- 専有面積順: `key=lambda x: x.get('area', 0)`

## 注意事項

- Webサイトの構造が変更された場合、スクリプトの修正が必要になる可能性があります
- サーバーに負荷をかけないよう、物件間で1秒の待機時間を設けています
- 取得できなかった情報は「-」として表示されます
- リフォーム情報が明記されていない場合は「無」として扱われます

## トラブルシューティング

### 取得に失敗する場合

1. インターネット接続を確認
2. URLが正しいか確認
3. Webサイトがアクセス可能か確認

### 情報が正しく取得できない場合

1. Webサイトの構造が変更された可能性があります
2. `debug_page.html` を生成して構造を確認できます（デバッグモード追加が必要）

## ライセンス

個人利用のみ

## 更新履歴

- 2025-10-07: v4 - 価格変遷追跡機能追加
  - JSON形式で全価格履歴を保存
  - 日次スナップショット保存
  - 4種類の変更検出（価格、新規物件、販売終了、担当者）
  - 自動変更レポート生成
  - 初出価格・最高値・最安値の自動計算
  
- 2025-10-07: v3 - 物件自動検出機能追加
  - 幅優先探索（BFS）による全物件自動発見
  - 面積フィルタリング（65㎡〜80㎡）
  - シード物件から自動的に関連物件を辿る
  - 手動指定モードとの切替可能
  - 7件の物件を自動検出（従来の6件から増加）
  
- 2025-10-06: v2 - 初版リリース
  - 6件の物件情報取得機能
  - Markdown形式での比較表生成
  - 平米単価順ソート機能
  - HTMLビューアー追加（ダークモード、ランキング表示、レスポンシブ対応）

