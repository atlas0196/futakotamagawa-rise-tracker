# 二子玉川ライズ 中古マンション比較表作成ツール

東急リバブルの公式サイトから二子玉川ライズの中古マンション物件情報を自動取得し、比較表を作成するツールです。

## 機能

### 🔍 物件自動検出機能（v3）NEW!
- **幅優先探索（BFS）**で二子玉川ライズの全物件を自動発見
- 3つの棟（イースト/ウエスト/セントラル）から自動的にリンクを辿る
- 面積フィルタ（65㎡〜80㎡）で条件に合う物件のみを抽出
- 手動でURLを追加する必要なし！

### 📊 データ取得・分析
- 各物件から以下の情報を自動取得：
  - 管理番号
  - 販売価格（億円単位にも対応）
  - 平米単価・坪単価（自動計算）
  - 間取り
  - 専有面積
  - 棟名（イースト/ウエスト/セントラル）
  - 階数（現在階/総階数）
  - 築年月
  - 向き
  - リフォーム有無
  - お気に入り登録数
  - 担当者名

### 📝 出力機能
- Markdown形式の比較表を生成
- 平米単価の安い順に自動ソート
- タイムスタンプ付きファイル名で保存
- HTMLビューアーで美しく表示

## セットアップ

### 必要な環境

- Python 3.7以上

### インストール

```bash
# 依存ライブラリのインストール
pip3 install -r requirements.txt
```

## 使い方

### 基本的な実行（自動検出モード）

```bash
python3 scraper.py
```

実行すると、以下の処理が行われます：

1. **物件自動検出**: シード物件から幅優先探索で全物件を発見
2. **面積フィルタ**: 65㎡〜80㎡の物件のみを抽出
3. **データ取得**: 各物件の詳細情報を取得
4. **比較表生成**: `comparison_table_YYYYMMDD_HHMMSS.md` を作成
5. **latest.md更新**: 最新データで更新

### 手動指定モード

`scraper.py`の冒頭で`AUTO_DISCOVER = False`に設定すると、手動指定モードになります。

```python
# scraper.py
AUTO_DISCOVER = False  # 手動指定モードに切替
```

手動モードでは`MANUAL_PROPERTY_URLS`リストの物件のみを取得します。

### ビジュアル表示（HTMLビューアー）

生成された比較表をブラウザーで美しく表示：

```bash
open viewer.html
```

または、Finderでダブルクリックして開く

**HTMLビューアーの特徴:**
- 🌙 ダークモード対応
- 📊 平米単価順のランキング表示
- 🎨 カラーバッジ（棟名・リフォーム有無）
- 📱 スマートフォン対応
- ✨ ホバーエフェクトやアニメーション
- 🔗 物件ページへの直リンク

### 出力例

```
============================================================
二子玉川ライズ 中古マンション比較表作成 v2
============================================================

[1/6] 取得中: https://www.livable.co.jp/mansion/C13252K32/
✓ C13252K32: 取得成功

[2/6] 取得中: https://www.livable.co.jp/mansion/C48258711/
✓ C48258711: 取得成功

...

✓ 比較表を作成しました: comparison_table_20251006_222711.md
```

### 生成される比較表の形式

| 管理番号 | 販売価格 | 平米単価 | 坪単価 | 間取り | 専有面積 | 棟名 | 階数 | 築年月 | 向き | リフォーム | 担当者 |
|---|---|---|---|---|---|---|---|---|---|---|---|
| C13252K32 | 15,800万円 | 224.69万円/㎡ | 741.5万円/坪 | 2LDK | 70.32㎡ | イースト | 17/42 | 2010年5月 | 南東 | 無 | 行方 |
| ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |

## ファイル構成

```
RISE/
├── README.md                      # このファイル
├── REQUIREMENTS.md                # 要件定義書（HTMLビューアー仕様含む）
├── requirements.txt               # Pythonパッケージ依存関係
├── scraper.py                     # メインスクリプト
├── viewer.html                    # HTMLビューアー（ブラウザー表示用）
├── latest.md                      # 最新の比較表（Markdown形式）
└── comparison_table_*.md          # 生成された比較表（複数・タイムスタンプ付き）
```

## カスタマイズ

### 対象物件の変更

`scraper.py` の `PROPERTY_URLS` リストを編集することで、取得する物件を変更できます：

```python
PROPERTY_URLS = [
    "https://www.livable.co.jp/mansion/C13252K32/",
    "https://www.livable.co.jp/mansion/C48258711/",
    # 追加の物件URLをここに記載
]
```

### ソート順の変更

デフォルトでは平米単価の安い順にソートされますが、以下の行を変更することで別の基準でソートできます：

```python
# scraper.py の generate_comparison_table 関数内
sorted_properties = sorted(valid_properties, key=lambda x: x.get('price_per_sqm', float('inf')))
```

例：
- 販売価格順: `key=lambda x: x.get('price', float('inf'))`
- 専有面積順: `key=lambda x: x.get('area', 0)`

## 注意事項

- Webサイトの構造が変更された場合、スクリプトの修正が必要になる可能性があります
- サーバーに負荷をかけないよう、物件間で1秒の待機時間を設けています
- 取得できなかった情報は「-」として表示されます
- リフォーム情報が明記されていない場合は「無」として扱われます

## トラブルシューティング

### 取得に失敗する場合

1. インターネット接続を確認
2. URLが正しいか確認
3. Webサイトがアクセス可能か確認

### 情報が正しく取得できない場合

1. Webサイトの構造が変更された可能性があります
2. `debug_page.html` を生成して構造を確認できます（デバッグモード追加が必要）

## ライセンス

個人利用のみ

## 更新履歴

- 2025-10-07: v3 - 物件自動検出機能追加
  - 幅優先探索（BFS）による全物件自動発見
  - 面積フィルタリング（65㎡〜80㎡）
  - シード物件から自動的に関連物件を辿る
  - 手動指定モードとの切替可能
  - 7件の物件を自動検出（従来の6件から増加）
  
- 2025-10-06: v2 - 初版リリース
  - 6件の物件情報取得機能
  - Markdown形式での比較表生成
  - 平米単価順ソート機能
  - HTMLビューアー追加（ダークモード、ランキング表示、レスポンシブ対応）

